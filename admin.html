<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Painel do Dono - Pedidos</title>
<style>
  body{font-family:Arial,Helvetica,sans-serif;background:#f6f8fb;color:#222;margin:0;padding:20px}
  .container{max-width:900px;margin:20px auto;background:#fff;padding:20px;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,.1)}
  h1{font-size:22px;margin-bottom:10px}
  input,textarea,button{margin:5px 0;padding:8px;font-size:14px}
  table{width:100%;border-collapse:collapse;margin-top:15px}
  th,td{border:1px solid #ddd;padding:8px;text-align:left;font-size:14px}
  th{background:#f0f0f0}
</style>
</head>
<body>
<div class="container">
  <h1>Painel do Dono - Pedidos</h1>
  
  <label>Senha de admin:</label><br>
  <input type="password" id="senha"><button onclick="login()">Entrar</button>
  
  <div id="painel" style="display:none;">
    <h2>Novo Pedido</h2>
    <input id="nome" placeholder="Nome do cliente"><br>
    <input id="cpf" placeholder="CPF"><br>
    <textarea id="desc" placeholder="Descrição do pedido"></textarea><br>
    <button onclick="criarPedido()">Adicionar Pedido</button>
    
    <h2>Todos os Pedidos</h2>
    <table>
      <thead>
        <tr><th>ID</th><th>Código</th><th>Nome</th><th>CPF</th><th>Status</th><th>Ações</th></tr>
      </thead>
      <tbody id="listaPedidos"></tbody>
    </table>
  </div>
</div>

<script>
let SENHA = "";
function login(){
  SENHA = document.getElementById("senha").value;
  carregarPedidos();
  document.getElementById("painel").style.display="block";
}

function criarPedido(){
  fetch("/api/orders",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      name:document.getElementById("nome").value,
      cpf:document.getElementById("cpf").value,
      description:document.getElementById("desc").value
    })
  })
  .then(r=>r.json()).then(d=>{
    alert("Pedido criado! Código: "+d.code);
    carregarPedidos();
  });
}

function carregarPedidos(){
  fetch("/api/orders?pass="+SENHA)
    .then(r=>r.json())
    .then(lista=>{
      let html="";
      lista.forEach(p=>{
        html+=`<tr>
          <td>${p.id}</td>
          <td>${p.code}</td>
          <td>${p.name}</td>
          <td>${p.cpf}</td>
          <td>
            <select onchange="atualizar(${p.id},this.value,'${p.name}','${p.cpf}','${p.description}')">
              <option ${p.status=='criado'?'selected':''}>criado</option>
              <option ${p.status=='em andamento'?'selected':''}>em andamento</option>
              <option ${p.status=='concluído'?'selected':''}>concluído</option>
            </select>
          </td>
          <td><button onclick="excluir(${p.id})">Excluir</button></td>
        </tr>`;
      });
      document.getElementById("listaPedidos").innerHTML=html;
    });
}

function atualizar(id,status,name,cpf,desc){
  fetch("/api/orders/"+id+"?pass="+SENHA,{
    method:"PUT",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({status,name,cpf,description:desc})
  }).then(()=>carregarPedidos());
}

function excluir(id){
  if(confirm("Excluir pedido "+id+"?")){
    fetch("/api/orders/"+id+"?pass="+SENHA,{method:"DELETE"})
      .then(()=>carregarPedidos());
  }
}
</script>
</body>
</html>
