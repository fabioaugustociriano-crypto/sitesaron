<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Rastreamento de Pedido</title>
<style>
  body{font-family:Arial,Helvetica,sans-serif;background:#f6f8fb;color:#222;margin:0;padding:20px}
  .container{max-width:820px;margin:20px auto;background:#fff;padding:18px;border-radius:10px;box-shadow:0 6px 18px rgba(12,30,60,0.06)}
  h1{margin-top:0}
  input{width:100%;padding:10px;border-radius:8px;border:1px solid #e6e9ef;box-sizing:border-box;margin-bottom:10px}
  button{background:#0b69ff;color:#fff;border:none;padding:10px 14px;border-radius:8px;cursor:pointer}
  .small{font-size:0.9rem;color:#556}
  .badge{padding:6px 10px;border-radius:8px;font-weight:600;display:inline-block}
  .badge.criado{background:#eef2ff;color:#1e3a8a}
  .badge.emproducao{background:#fff6e6;color:#7a4b00}
  .badge.separado{background:#fff0f6;color:#7a1a4a}
  .badge.entregue{background:#e6f7ed;color:#177a3b}
  .result{margin-top:14px;padding:12px;border-radius:8px;border:1px solid #eef2f7;background:#fbfeff}
  .note{font-size:0.85rem;color:#666;margin-top:8px}
</style>
</head>
<body>
  <div class="container">
    <h1>Rastreamento de Pedido</h1>
    <p class="small">Digite o <strong>código</strong> do rastreador (nome + 4 primeiros dígitos do CPF)<br>
    Ex.: <em>joaosilva1234</em></p>

    <input id="codeInput" placeholder="ex: joaosilva1234" />
    <button id="searchBtn">Buscar Pedido</button>

    <div id="result"></div>

    <hr/>
    <p class="note">Se você é o dono do site, acesse <a href="admin.html">Painel do Dono</a>.</p>
  </div>

<script>
function normalizeName(name){
  return (name||'').normalize('NFD').replace(/[\u0300-\u036f]/g,'')
    .toLowerCase().replace(/[^a-z0-9]/g,'');
}
function digitsOnly(s){ return (s||'').replace(/\D/g,''); }
function generateCode(name, cpf){
  const n = normalizeName(name);
  const c = digitsOnly(cpf).slice(0,4);
  return (n + c);
}
function loadOrders(){ return JSON.parse(localStorage.getItem('orders_v1')||'[]'); }

const resultEl = document.getElementById('result');
document.getElementById('searchBtn').addEventListener('click', ()=> {
  const code = document.getElementById('codeInput').value.trim();
  resultEl.innerHTML = '';
  if(!code){ resultEl.innerHTML = '<p class="small">Informe o código.</p>'; return; }
  const orders = loadOrders();
  const order = orders.find(o => o.code === code);
  if(!order){ resultEl.innerHTML = '<p class="small">Pedido não encontrado.</p>'; return; }
  renderOrder(order);
});

function renderOrder(o){
  const statusClass = o.status.replace(/\s/g,'').replace('ê','e');
  resultEl.innerHTML = `
    <div class="result">
      <h3>Pedido: ${o.code}</h3>
      <div><strong>Nome:</strong> ${o.name}</div>
      <div><strong>Descrição:</strong> ${o.description || '-'}</div>
      <div><strong>Status:</strong> <span class="badge ${statusClass}">${o.status}</span></div>
      <div class="small">Criado: ${new Date(o.createdAt).toLocaleString()} • Atualizado: ${new Date(o.updatedAt).toLocaleString()}</div>
    </div>
  `;
}
</script>
</body>
</html>
